- name: Create Kubernetes Cluster with Kops
  hosts: k8s_master
  become: yes
  tasks:
    - name: Set environment variables for Kops and AWS
      shell: |
        export KOPS_STATE_STORE=s3://debby-kops-final-state-bucket
        export AWS_DEFAULT_REGION=us-east-2
        kops create cluster \
          --name=devcluster.k8s.local \
          --zones=us-east-2a,us-east-2b \
          --state=s3://debby-kops-final-state-bucket \
          --node-count=2 \
          --node-size=t2.small \
          --control-plane-size=t2.small \
          --dns=none \
          --yes
      args:
        executable: /bin/bash
